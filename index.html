<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Explorer</title>
  <link rel="stylesheet" href="css/win95.css">
</head>
<body>

<div class="window">
  <div class="title-bar">
    <span class="title-bar-text">Recipe Explorer - Lab Notebook</span>
    <div class="window-controls">
      <div class="window-btn">_</div>
      <div class="window-btn">□</div>
      <div class="window-btn">×</div>
    </div>
  </div>

  <div class="menu-bar">
    <span class="menu-item"><u>F</u>ile</span>
    <span class="menu-item"><u>E</u>dit</span>
    <span class="menu-item" id="view-menu">
      <u>V</u>iew
      <div class="menu-dropdown" id="theme-dropdown">
        <span class="menu-dropdown-item" onclick="setTheme('teal')"><span class="checkmark"></span> Teal</span>
        <span class="menu-dropdown-item" onclick="setTheme('slate')"><span class="checkmark"></span> Slate</span>
        <span class="menu-dropdown-item" onclick="setTheme('olive')"><span class="checkmark"></span> Olive</span>
        <span class="menu-dropdown-item" onclick="setTheme('plum')"><span class="checkmark">✓</span> Plum</span>
        <span class="menu-dropdown-item" onclick="setTheme('storm')"><span class="checkmark"></span> Storm</span>
        <span class="menu-dropdown-item" onclick="setTheme('charcoal')"><span class="checkmark"></span> Charcoal</span>
      </div>
    </span>
    <span class="menu-item">Fav<u>o</u>rites</span>
    <span class="menu-item"><u>H</u>elp</span>
  </div>

  <div class="toolbar">
    <button class="toolbar-btn active" onclick="filterRecipes('all', event)">All</button>
    <button class="toolbar-btn" onclick="filterRecipes('canonical', event)">Dialed In</button>
    <button class="toolbar-btn" onclick="filterRecipes('experimenting', event)">Experimenting</button>
  </div>

  <div class="content" style="min-height: 400px;">
    <div class="recipe-grid" id="recipe-grid">
      <!-- Recipe cards rendered by JS -->
    </div>
  </div>

  <div class="status-bar">
    <span class="status-bar-section" id="recipe-count">Loading...</span>
    <span class="status-bar-section" id="filter-status">Filter: All</span>
  </div>
</div>

<script src="js/utils.js"></script>
<script src="js/manifest.js"></script>
<script>
  let currentFilter = 'all';

  document.addEventListener('DOMContentLoaded', () => {
    renderRecipeGrid(RECIPE_MANIFEST);
    updateStatus();
  });

  function renderRecipeGrid(recipes) {
    const grid = document.getElementById('recipe-grid');
    grid.innerHTML = '';

    const filtered = filterByCurrentFilter(recipes);

    if (filtered.length === 0) {
      grid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1/-1;">No recipes match the current filter.</p>';
      return;
    }

    filtered.forEach(recipe => {
      const card = createRecipeCard(recipe);
      grid.appendChild(card);
    });
  }

  function formatTime(minutes) {
    if (minutes < 60) return `${minutes} min`;
    const h = Math.floor(minutes / 60);
    const m = minutes % 60;
    return m > 0 ? `${h}h ${m}m` : `${h}h`;
  }

  function createRecipeCard(recipe) {
    const card = document.createElement('div');
    card.className = 'recipe-card' + (recipe.canonical ? ' canonical' : '');
    card.onclick = () => location.href = `recipe.html?id=${recipe.id}`;

    const totalTime = (recipe.time?.prep || 0) + (recipe.time?.cook || 0);

    const tagsHtml = recipe.tags.slice(0, 3).map(tag =>
      `<span class="tag" style="background: ${getTagColor(tag)}">${tag}</span>`
    ).join('');

    card.innerHTML = `
      <div class="recipe-card-title">${recipe.title}</div>
      <div class="recipe-card-desc">${recipe.desc || ''}</div>
      <div style="font-size: 10px; color: #666; margin-top: 5px;">${formatTime(totalTime)} total</div>
      <div class="tags">${tagsHtml}</div>
    `;

    return card;
  }

  function filterRecipes(filter, event) {
    currentFilter = filter;
    renderRecipeGrid(RECIPE_MANIFEST);
    updateStatus();

    // Update toolbar button states
    document.querySelectorAll('.toolbar-btn').forEach(btn => {
      btn.classList.remove('active');
    });
    if (event && event.target) {
      event.target.classList.add('active');
    }
  }

  function filterByCurrentFilter(recipes) {
    if (currentFilter === 'all') return recipes;
    if (currentFilter === 'canonical') return recipes.filter(r => r.canonical);
    if (currentFilter === 'experimenting') return recipes.filter(r => !r.canonical);
    return recipes;
  }

  function updateStatus() {
    const filtered = filterByCurrentFilter(RECIPE_MANIFEST);
    document.getElementById('recipe-count').textContent = `${filtered.length} recipe${filtered.length !== 1 ? 's' : ''}`;

    const filterLabels = {
      'all': 'All',
      'canonical': 'Dialed In',
      'experimenting': 'Experimenting'
    };
    document.getElementById('filter-status').textContent = `Filter: ${filterLabels[currentFilter]}`;
  }
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Explorer</title>
  <link rel="stylesheet" href="css/win95.css">
</head>
<body>

<div class="window">
  <div class="title-bar">
    <span class="title-bar-text">Recipe Explorer - Lab Notebook</span>
    <div class="window-controls">
      <div class="window-btn">_</div>
      <div class="window-btn">X</div>
    </div>
  </div>

  <div class="menu-bar">
    <span class="menu-item">File</span>
    <span class="menu-item">Edit</span>
    <span class="menu-item">View</span>
    <span class="menu-item">Favorites</span>
    <span class="menu-item">Help</span>
  </div>

  <div class="toolbar">
    <button class="toolbar-btn" onclick="filterRecipes('all')">All</button>
    <button class="toolbar-btn" onclick="filterRecipes('canonical')">Dialed In</button>
    <button class="toolbar-btn" onclick="filterRecipes('experimenting')">Experimenting</button>
  </div>

  <div class="content" style="min-height: 400px;">
    <div class="recipe-grid" id="recipe-grid">
      <!-- Recipe cards rendered by JS -->
    </div>
  </div>

  <div class="status-bar">
    <span class="status-bar-section" id="recipe-count">Loading...</span>
    <span class="status-bar-section" id="filter-status">Filter: All</span>
  </div>
</div>

<script src="js/manifest.js"></script>
<script>
  let currentFilter = 'all';

  document.addEventListener('DOMContentLoaded', () => {
    renderRecipeGrid(RECIPE_MANIFEST);
    updateStatus();
  });

  function renderRecipeGrid(recipes) {
    const grid = document.getElementById('recipe-grid');
    grid.innerHTML = '';

    const filtered = filterByCurrentFilter(recipes);

    if (filtered.length === 0) {
      grid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1/-1;">No recipes match the current filter.</p>';
      return;
    }

    filtered.forEach(recipe => {
      const card = createRecipeCard(recipe);
      grid.appendChild(card);
    });
  }

  function createRecipeCard(recipe) {
    const card = document.createElement('div');
    card.className = 'recipe-card';
    card.onclick = () => location.href = `recipe.html?id=${recipe.id}`;

    const icon = recipe.canonical ? '\uD83D\uDCD6' : '\uD83D\uDCC4';
    const canonicalStar = recipe.canonical ? ' \u2B50' : '';
    const totalTime = (recipe.time?.prep || 0) + (recipe.time?.cook || 0);

    const tagsHtml = recipe.tags.slice(0, 3).map(tag =>
      `<span class="tag ${tag}">${tag}</span>`
    ).join('');

    card.innerHTML = `
      <div class="recipe-icon">${icon}</div>
      <div class="recipe-card-title">${recipe.title}${canonicalStar}</div>
      <div class="recipe-card-version">v${recipe.version}</div>
      <div class="recipe-card-difficulty">${recipe.difficulty}</div>
      <div style="font-size: 10px; color: #666; margin-top: 5px;">${totalTime} min total</div>
      <div class="tags">${tagsHtml}</div>
    `;

    return card;
  }

  function filterRecipes(filter) {
    currentFilter = filter;
    renderRecipeGrid(RECIPE_MANIFEST);
    updateStatus();
  }

  function filterByCurrentFilter(recipes) {
    if (currentFilter === 'all') return recipes;
    if (currentFilter === 'canonical') return recipes.filter(r => r.canonical);
    if (currentFilter === 'experimenting') return recipes.filter(r => !r.canonical);
    return recipes;
  }

  function updateStatus() {
    const filtered = filterByCurrentFilter(RECIPE_MANIFEST);
    document.getElementById('recipe-count').textContent = `${filtered.length} recipe${filtered.length !== 1 ? 's' : ''}`;

    const filterLabels = {
      'all': 'All',
      'canonical': 'Dialed In',
      'experimenting': 'Experimenting'
    };
    document.getElementById('filter-status').textContent = `Filter: ${filterLabels[currentFilter]}`;
  }
</script>
</body>
</html>
